<div class="fixed inset-0 z-50 flex items-center justify-center p-6">
  <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" (click)="close()"></div>
  <div (click)="$event.stopPropagation()" class="w-full max-w-2xl bg-white rounded-[40px] shadow-2xl shadow-blue-100/40 p-10 relative">
    <!-- close button -->
    <button type="button" (click)="close()" aria-label="Chiudi" class="absolute top-4 right-4 p-2 rounded-lg text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-colors">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <h2 class="text-2xl font-black mb-6 text-[#0F172A]">Nuovo Sinistro</h2>

    <form (ngSubmit)="submit()" class="flex flex-col gap-6">

      <!-- automobilista id -->
      <div class="flex flex-col gap-1.5">
        <label class="text-xs font-black text-slate-500 uppercase tracking-widest">Automobilista ID</label>
        <input
          type="number"
          [(ngModel)]="formData.automobilista_id"
          name="automobilista_id"
          required
          class="w-full pl-3 pr-4 py-3 text-sm rounded-xl border border-slate-200 bg-slate-50 text-slate-800 placeholder-slate-300 font-medium
                   focus:outline-none focus:ring-2 focus:ring-[#1E40AF]/20 focus:border-[#1E40AF] transition-all"
        />
      </div>

      <!-- veicoli -->
      <div>
        <label class="text-xs font-black text-slate-500 uppercase tracking-widest mb-2 block">Veicoli</label>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <div
            *ngFor="let v of vehicles"
            (click)="selectVehicle(v)"
            class="cursor-pointer p-4 rounded-xl border transition-all relative"
            [class.border-blue-500]="v.selected"
            [class.border-slate-200]="!v.selected"
          >
            <div class="font-semibold">{{ v.targa }}</div>
            <svg
              *ngIf="v.selected"
              class="w-6 h-6 text-blue-500 absolute top-2 right-2"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414L8.414 15l-4.121-4.121a1 1 0 011.414-1.414L8.414 12.172l7.879-7.879a1 1 0 011.414 0z"
                clip-rule="evenodd"
              />
            </svg>
          </div>
        </div>
      </div>

      <!-- data evento -->
      <div class="flex flex-col gap-1.5">
        <label class="text-xs font-black text-slate-500 uppercase tracking-widest">Data evento</label>
        <div class="relative">
          <span class="absolute inset-y-0 left-3.5 flex items-center pointer-events-none">
            <i class="bi bi-calendar3 text-slate-400"></i>
          </span>
          <input
            type="date"
            [(ngModel)]="formData.data_evento"
            name="data_evento"
            required
            class="w-full pl-10 pr-4 py-3 text-sm rounded-xl border border-slate-200 bg-slate-50 text-slate-800 font-medium
                   focus:outline-none focus:ring-2 focus:ring-[#1E40AF]/20 focus:border-[#1E40AF] transition-all"
          />
        </div>
      </div>

      <!-- descrizione -->
      <div class="flex flex-col gap-1.5">
        <label class="text-xs font-black text-slate-500 uppercase tracking-widest">Descrizione</label>
        <div class="relative">
          <span class="absolute inset-y-0 left-3.5 flex items-center pointer-events-none">
            <i class="bi bi-pencil-square text-slate-400"></i>
          </span>
          <textarea
            [(ngModel)]="formData.descrizione"
            name="descrizione"
            rows="4"
            required
            class="w-full pl-10 pr-4 py-3 text-sm rounded-xl border border-slate-200 bg-slate-50 text-slate-800 font-medium
                   focus:outline-none focus:ring-2 focus:ring-[#1E40AF]/20 focus:border-[#1E40AF] transition-all resize-none"
          ></textarea>
        </div>
      </div>

      <!-- feedback messages -->
      <div *ngIf="errorMessage" class="text-red-600 text-xs font-semibold">{{ errorMessage }}</div>
      <div *ngIf="successMessage" class="text-green-600 text-xs font-semibold">{{ successMessage }}</div>

      <!-- submit -->
      <button
        type="submit"
        [disabled]="loading"
        class="w-full py-3 bg-[#0F172A] text-white text-sm font-extrabold rounded-xl tracking-wide
               shadow-lg shadow-blue-200 transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2"
      >
        <svg *ngIf="loading" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
        </svg>
        {{ loading ? 'Invio in corso...' : 'Crea Sinistro' }}
      </button>
    </form>
  </div>
</div>
